<input
  class="play-select-input"
  readonly
  [value]="label"
  [placeholder]="placeholder"
  [disabled]="disabled"
  cdkOverlayOrigin
  #trigger="cdkOverlayOrigin"
/>

<ng-template
  cdkConnectedOverlay
  cdkConnectedOverlayHasBackdrop="true"
  cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
  [cdkConnectedOverlayOrigin]="trigger"
  [cdkConnectedOverlayOpen]="isOpen"
  [cdkConnectedOverlayWidth]="elRef.nativeElement.getBoundingClientRect().width"
  [cdkConnectedOverlayOffsetX]="-1"
  (backdropClick)="isOpen = false"
>
  <div class="play-virtual-scroll-wrapper">
    <input
      *ngIf="showSearch"
      class="play-select-search-input"
      playInputText
      [formControl]="searchCtrl"
      type="text"
      placeholder="Search..."
    />
    <cdk-virtual-scroll-viewport
      [style.height.px]="viewportHeight$ | async"
      [itemSize]="itemSize"
      class="play-select-list"
    >
      <ng-container *ngIf="multiple; else singleValueTemplate">
        <li
          *cdkVirtualFor="let option of filteredOptions$ | async"
          class="play-select-option"
          (click)="toggleOption(option)"
        >
          <play-checkbox [checked]="selection.isSelected(option)">
            <template
              [ngTemplateOutlet]="template"
              [ngTemplateOutletContext]="{ $implicit: option }"
            ></template>
          </play-checkbox>
        </li>
      </ng-container>

      <ng-template #singleValueTemplate>
        <li
          *cdkVirtualFor="let option of filteredOptions$ | async"
          class="play-select-option"
          [class.play-select-option-active]="selection.isSelected(option)"
          (click)="toggleOption(option)"
        >
          <template
            [ngTemplateOutlet]="template"
            [ngTemplateOutletContext]="{ $implicit: option }"
          ></template>
        </li>
      </ng-template>
    </cdk-virtual-scroll-viewport>
  </div>
</ng-template>
